# Research Report: OpenAI Codex CLI Session Storage

Generated: 2026-01-21

## Summary

OpenAI Codex CLI stores conversation sessions as JSONL (JSON Lines) files in `~/.codex/sessions/` organized by date. Each session file contains a metadata header followed by event records capturing user inputs, agent responses, tool calls, and token usage. Sessions can be resumed programmatically via CLI commands using session IDs.

## Questions Answered

### Q1: Where are sessions stored?

**Answer:** Sessions are stored in the `CODEX_HOME` directory (defaults to `~/.codex/`), specifically:
- Primary location: `~/.codex/sessions/YYYY/MM/DD/rollout-{timestamp}-{SESSION_ID}.jsonl`
- Historical conversations: `~/.codex/history.jsonl`
- Archived sessions: `~/.codex/archived_sessions/`

**Source:** [Codex CLI Features](https://developers.openai.com/codex/cli/features/)
**Confidence:** High

### Q2: What is the file format?

**Answer:** JSONL (JSON Lines) format. Each line is a valid JSON object representing a session event. The main files are:
- `rollout-*.jsonl` - Per-session transcripts with full conversation history
- `history.jsonl` - Aggregated history across sessions

**Source:** [Advanced Configuration](https://developers.openai.com/codex/config-advanced/)
**Confidence:** High

### Q3: What is the schema/structure of session data?

**Answer:** Each JSONL session file contains:

**Metadata header line:**
- Session ID
- Source (cli, vscode, etc.)
- Timestamp
- Model provider

**Event lines (RolloutItem records):**
- User turns (user messages)
- Agent responses
- Tool calls and results
- Reasoning traces
- Token usage counts
- File changes
- Plan updates
- Errors

**Event types include:**
- `thread.started` - Contains `thread_id`
- `turn.started` / `turn.completed` / `turn.failed`
- `item.started` / `item.updated` / `item.completed`
- `error`

**Item types include:**
- `agent_message` (formerly `assistant_message`)
- `command_execution`
- `file_change`
- `mcp_tool_call`
- `web_search`
- `plan_update`
- `reasoning`

**Example JSONL structure:**
```json
{"type":"thread.started","thread_id":"0199a213-81c0-7800-8aa1-bbab2a035a53"}
{"type":"turn.started"}
{"type":"item.started","item":{"id":"item_1","type":"command_execution","command":"bash -lc ls","status":"in_progress"}}
{"type":"item.completed","item":{"id":"item_3","type":"agent_message","text":"..."}}
{"type":"turn.completed","usage":{"input_tokens":24763,"cached_input_tokens":24448,"output_tokens":122}}
```

**Source:** [Non-interactive mode docs](https://developers.openai.com/codex/noninteractive/)
**Confidence:** High

### Q4: How to resume sessions programmatically?

**Answer:** Sessions can be resumed via CLI commands:

**Interactive mode:**
```bash
# Launch picker of recent sessions
codex resume

# Resume most recent session
codex resume --last

# Resume specific session by ID
codex resume <SESSION_ID>

# Show all sessions (not just current directory)
codex resume --all
```

**Non-interactive (exec) mode:**
```bash
# Resume last session with follow-up prompt
codex exec resume --last "Fix the race conditions"

# Resume specific session
codex exec resume <SESSION_ID> "Implement the plan"
```

**Finding session IDs:**
- From `/status` slash command in Codex
- From session picker UI
- From files in `~/.codex/sessions/`
- Extract from JSONL: `tail -n 1 "$SESSION_LOG" | jq -r '.content[0].text'`

**Note:** When resuming, new events are appended to the existing rollout file rather than creating a new file, maintaining complete history in a single file.

**Source:** [Command line options](https://developers.openai.com/codex/cli/reference/)
**Confidence:** High

## Detailed Findings

### Finding 1: Session File Organization

**Source:** [Codex CLI Features](https://developers.openai.com/codex/cli/features/)

**Key Points:**
- Sessions organized by date: `sessions/YYYY/MM/DD/`
- Filename pattern: `rollout-{timestamp}-{SESSION_ID}.jsonl`
- The `RolloutRecorder` component manages session persistence
- Configuration at `~/.codex/config.toml` controls history behavior

**Configuration options:**
```toml
# In ~/.codex/config.toml
[history]
max_bytes = 10485760  # Cap history file size (drops oldest entries when exceeded)
```

### Finding 2: JSON Output Mode for Programmatic Access

**Source:** [Non-interactive mode](https://developers.openai.com/codex/noninteractive/)

**Key Points:**
- Use `--json` flag to get JSONL stream output
- Enables capturing every event programmatically
- Useful for building integrations and pipelines

**Code Example:**
```bash
# Get JSONL stream of all events
codex exec --json "summarize the repo structure" | jq

# Process specific event types
codex exec --json "task" | jq 'select(.type == "item.completed")'
```

### Finding 3: Session Metadata and Token Tracking

**Source:** [Session Resumption DeepWiki](https://deepwiki.com/openai/codex/4.4-app-server-and-json-rpc-protocol)

**Key Points:**
- Each `token_count` event reports cumulative totals
- The `turn_context` metadata specifies active model
- Tokens aggregated per day/month and per model
- Git info, CWD, CLI version included in thread/turn data (v0.64.0+)

### Finding 4: Rust Implementation Details

**Source:** [GitHub openai/codex](https://github.com/openai/codex)

**Key Points:**
- Core implementation in `codex-rs/core/` directory
- `RolloutRecorder` handles session persistence
- `RolloutItem` struct represents each JSONL line
- Schema for config at `codex-rs/core/config.schema.json`
- 50 member crates in the Cargo workspace

## Comparison Matrix

| Storage Aspect | Claude Code | OpenAI Codex CLI |
|----------------|-------------|------------------|
| Location | `~/.claude/` | `~/.codex/` |
| Format | SQLite + JSON | JSONL |
| Organization | Flat | Date-based directories |
| Resume | Not built-in | `codex resume` command |
| Session ID | Implicit | Explicit UUID |
| Token tracking | Via API | Built into JSONL events |

## Recommendations

### For Implementation Reference
1. The JSONL format is simple and appendable - good for streaming writes
2. Date-based directory organization helps with cleanup/archival
3. Separate history.jsonl for quick access to recent sessions
4. Event-based schema allows for extensibility

### Integration Notes
- Use `codex exec --json` for programmatic access to session data
- Session IDs are UUIDs, extractable from filenames or JSONL content
- The `--last` flag simplifies resuming most recent session
- No dedicated SDK/API library - CLI is the primary interface

## Sources

1. [Codex CLI Features](https://developers.openai.com/codex/cli/features/) - Official documentation on session storage and resume
2. [Command line options](https://developers.openai.com/codex/cli/reference/) - CLI reference for resume commands
3. [Advanced Configuration](https://developers.openai.com/codex/config-advanced/) - History configuration options
4. [Non-interactive mode](https://developers.openai.com/codex/noninteractive/) - JSON output mode and exec resume
5. [GitHub openai/codex](https://github.com/openai/codex) - Main repository
6. [Codex Changelog](https://developers.openai.com/codex/changelog/) - Feature history and updates
7. [Session Resumption Discussion](https://github.com/openai/codex/discussions/1076) - Community discussion on resume feature
8. [Session Transcripts Issue](https://github.com/openai/codex/issues/2765) - Reproducibility and session transcripts
9. [JSON Schema Issue](https://github.com/openai/codex/issues/1673) - Request for formal JSON schema (open issue)
10. [Configuration Reference](https://developers.openai.com/codex/config-reference/) - Full config options

## Open Questions

- The detailed JSON schema for session JSONL output is not formally documented (open issue #1673)
- No official SDK/library for programmatic session manipulation - only CLI access
- Exact `RolloutItem` struct fields require browsing Rust source code directly
