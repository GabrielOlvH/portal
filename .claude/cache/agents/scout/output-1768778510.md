# Keyboard Accessory Files Report
Generated: 2026-01-18

## Summary
Found keyboard accessory implementation in terminal screens with paste, image upload, and snippet functionality. The session terminal has a full helper bar while the Docker terminal only has basic copy support.

---

## Terminal Screens with Keyboard Accessories

### 1. Session Terminal (Full Implementation)
**File:** `/home/gabrielolv/Documents/Projects/ter/app/session/[hostId]/[name]/terminal.tsx`

**Features:**
- ✅ Custom keyboard accessory bar (helper bar)
- ✅ Paste from clipboard
- ✅ Image upload (camera + library)
- ✅ Special keys (Tab, Ctrl+C, Esc, arrows)
- ✅ Custom snippets integration
- ✅ Haptic feedback
- ✅ Copy selection to clipboard

**Keyboard Accessory Bar Contents (line 760-808):**
1. **Done button** (ChevronDown) - Dismisses keyboard
2. **Paste button** (ClipboardPaste) - Pastes from system clipboard
3. **Image button** (ImageIcon) - Opens camera/library picker
4. **Helper keys** - Tab, Ctrl+C, Esc, arrow keys
5. **Snippets** - Dynamically loaded from snippets store

**Image Upload Flow:**
- Lines 500-531: Image picker integration with `expo-image-picker`
- Supports both camera and photo library
- Uploads as base64, returns file path
- Automatically inserts path into terminal

**Paste Implementation (line 771-778):**
```typescript
const text = await Clipboard.getStringAsync();
if (text) sendToTerminal(text);
```

**Copy Implementation (line 728):**
```typescript
await Clipboard.setStringAsync(payload.text);
```

---

### 2. Docker Terminal (Basic Implementation)
**File:** `/home/gabrielolv/Documents/Projects/ter/app/hosts/[id]/docker/[containerId]/terminal.tsx`

**Features:**
- ✅ Copy selection to clipboard
- ❌ No paste button
- ❌ No image upload
- ❌ No helper bar/keyboard accessory
- ⚠️ Uses `hideKeyboardAccessoryView={true}` (line 369)

**What's Missing:**
The Docker terminal disables the default iOS keyboard accessory but doesn't provide a custom replacement. Only has copy functionality via WebView message (line 381).

---

## Supporting Files

### 3. Snippets Store
**File:** `/home/gabrielolv/Documents/Projects/ter/lib/snippets-store.tsx`

**Purpose:** Manages reusable command snippets shown in keyboard accessory

**Key Functions:**
- `buildDefaultSnippets()` - Creates initial snippets with IDs
- `loadSnippets()` - Loads from AsyncStorage
- `saveSnippets()` - Persists to AsyncStorage
- `SnippetsProvider` - React context provider
- `useSnippets()` - Hook to access snippets

**Storage Key:** `'tmux.snippets.v1'`

**API:**
- `snippets: Snippet[]` - List of all snippets
- `addSnippet(label, command)` - Add new snippet
- `updateSnippet(id, updates)` - Edit existing snippet
- `removeSnippet(id)` - Delete snippet

---

### 4. Snippets Management Screen
**File:** `/home/gabrielolv/Documents/Projects/ter/app/snippets/index.tsx`

**Purpose:** UI for creating/editing/deleting snippets

**Features:**
- Add new snippets with label and command
- Edit existing snippets
- Delete with confirmation dialog
- Empty state message
- Form validation

**Integration:**
- Accessible from More tab: `/app/(tabs)/more.tsx` line 234
- Registered in app layout: `/app/_layout.tsx` line 109

---

### 5. Launch Sheet (Uses Snippets)
**File:** `/home/gabrielolv/Documents/Projects/ter/components/LaunchSheet.tsx`

**Purpose:** Bottom sheet for launching sessions/commands

**Snippet Integration:**
- Displays snippets in launch options (line 495-516)
- Blank snippet launch mode (line 600-621)
- Sends snippet command on selection (line 235)

---

## Architecture

### Keyboard Accessory Flow (Session Terminal)
```
[User opens keyboard]
        ↓
[Helper bar renders above keyboard at keyboardInset]
        ↓
[User taps button]
        ↓
[Haptic feedback fires]
        ↓
[Action executes: paste/image/snippet/key]
        ↓
[Text sent to terminal via sendToTerminal()]
```

### Snippet Flow
```
[User manages snippets in /snippets screen]
        ↓
[Saved to AsyncStorage via SnippetsProvider]
        ↓
[useSnippets() hook in terminal screen]
        ↓
[Rendered as buttons in helper bar]
        ↓
[Tapping sends snippet.command to terminal]
```

### Image Upload Flow
```
[User taps image button in helper bar]
        ↓
[ActionSheet shows: Take Photo / Choose Photo]
        ↓
[expo-image-picker launches]
        ↓
[Image converted to base64]
        ↓
[uploadImage() sends to host via HTTP]
        ↓
[Server returns file path]
        ↓
[Path inserted into terminal]
```

---

## Key Dependencies

| Package | Usage |
|---------|-------|
| `expo-clipboard` | System clipboard read/write |
| `expo-image-picker` | Camera and photo library access |
| `expo-haptics` | Tactile feedback on button press |
| `@react-native-async-storage/async-storage` | Snippet persistence |
| `lucide-react-native` | Icons (ClipboardPaste, Image, ChevronDown) |

---

## Type Definitions

**Snippet Type** (from `/lib/types.ts`):
```typescript
interface Snippet {
  id: string;
  label: string;
  command: string;
  providerIcon?: string;
}
```

**Helper Key Type** (session terminal):
```typescript
interface HelperKey {
  label: string;
  data: string;
  icon?: React.ComponentType;
}
```

---

## Differences: Session vs Docker Terminal

| Feature | Session Terminal | Docker Terminal |
|---------|------------------|-----------------|
| **Custom helper bar** | ✅ Yes | ❌ No |
| **Paste button** | ✅ Yes | ❌ No |
| **Image upload** | ✅ Yes | ❌ No |
| **Snippets** | ✅ Yes | ❌ No |
| **Special keys** | ✅ Tab, Ctrl+C, Esc, arrows | ❌ No |
| **Copy selection** | ✅ Yes | ✅ Yes |
| **hideKeyboardAccessoryView** | ❌ No (has custom bar) | ✅ Yes (no replacement) |

---

## Files Summary

1. **`/app/session/[hostId]/[name]/terminal.tsx`** - Full keyboard accessory implementation with paste, image upload, snippets, and special keys

2. **`/app/hosts/[id]/docker/[containerId]/terminal.tsx`** - Basic terminal with only copy support, no keyboard accessory

3. **`/lib/snippets-store.tsx`** - State management for reusable command snippets

4. **`/app/snippets/index.tsx`** - UI screen for managing snippets

5. **`/components/LaunchSheet.tsx`** - Bottom sheet that uses snippets for quick launch

---

## Next Steps (Potential Improvements)

1. **Add keyboard accessory to Docker terminal** - Currently missing paste/image/snippets
2. **Unify terminal implementations** - Share keyboard accessory component between session and Docker terminals
3. **Add snippet categories** - Group snippets by type (git, docker, system, etc.)
4. **Snippet import/export** - Share snippet collections
5. **Image preview before upload** - Show cropping/editing options
